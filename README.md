# FearServMod is a client and server mod for
F.E.A.R. v1.08<br>
F.E.A.R. Combat v1.08<br>
F.E.A.R. Perseus Mandate v1.0<br>

# Features list
Multiplayer works again thanks to openspy.net<br>
Client side fixes (fps drops, flickering, glitches)<br>
Server side fixes (hacks, crashes, glitches)<br>
Allows coop mode based on F.E.A.R. Platinum (contains 55 maps)<br>
Allows play on servers created on retail or free versions and vice versa<br>
Allows to create 64 players servers<br>
Allows play on servers generated by TinyServerBuilder<br>

# How to play F.E.A.R. v1.08
1. Install a game
2. Replace FEAR.exe and FEARMP.exe to FEAR.exe from "No-CD patch" https://github.com/anzz1/openspy-client
3. Put https://github.com/Vityacv/fearservmod/blob/master/bin/winmm.dll to game folder
4. Launch the game and select Multiplayer - Client Settings - CD Key - type random text (should be unique for every player in same server)

# How to play F.E.A.R. Combat v1.08
1. Find free game on https://github.com/anzz1/openspy-client
2. Install a game and apply v1.08 update
3. Replace FEARMP.exe to FEAR.exe from "No-CD patch" https://github.com/anzz1/openspy-client
4. Put https://github.com/Vityacv/fearservmod/blob/master/bin/winmm.dll to game folder
5. Launch the game and select Multiplayer - Client Settings - CD Key - type random text (should be unique for every player in same server)

# How to play F.E.A.R. Perseus Mandate v1.0
1. Install a game
2. Replace FEARXP2.exe from "No-CD patch" https://github.com/anzz1/openspy-client
3. Put https://github.com/Vityacv/fearservmod/blob/master/bin/winmm.dll to game folder
4. Launch the game and select Multiplayer - Client Settings - CD Key - type random text (should be unique for every player in same server)

# How to play coop mode based on F.E.A.R. Platinum
1. Install a game
2. Replace FEARXP2.exe from "No-CD patch" https://github.com/anzz1/openspy-client
3. Put https://github.com/Vityacv/fearservmod/blob/master/bin/winmm.dll to game folder
4. Put https://github.com/Vityacv/fearservmod/blob/master/CoopMode.archcfg to game folder
5. Use FEARXP2.exe -archcfg CoopMode.archcfg to play and FEARServerXP.exe -archcfg CoopMode.archcfg to start local or public server
6. Launch the game and change following settings:<br>
    • Multiplayer - Host - Bandwidth - T3 (avoid lags)<br>
    • Multiplayer - Client Settings - CD Key - type random text (should be unique for every player in same server)<br>
    • Multiplayer - Client Settings - Bandwidth - T3 (avoid lags)<br>
7. Open ServerOptions0000.txt and add on top of it:
```
[Extra]
CoopMode=1

[SinglePlayer]
SessionName=Coop Mode
```

Players can use "Call vote" -> "Next map" or "New map" to select specific map (to scroll list use PageUp/PageDown)<br>

# Options and tweaks

Additional options in ServerOptions0000.txt for all type of game servers<br>

1. Synchronize all objects on map for all players (bottles, boxes, etc.)<br>
```
[Extra]
SyncObjects=1
```

2. Random weapons - every 2 min auto switch weapons for all players on server (all game modes)<br>
```
[Extra]
RandomWeapon=1
```

OpenSpy is default master server, but if you want to use other master server, add following lines to gamecfg.txt<br>
```
[Client]
;ShowIntro=1
Master=http://master.fear-combat.org/api/serverlist-ingame.php
;MOTD=http://motd.gamespy.com/motd/vercheck.asp?userid=%d&productid=%d&versionuniqueid=%s&distid=%d&uniqueid=%s&gamename=%s

[Server]
Master=master.fear-combat.org
Available=master.fear-combat.org
NS1=n1.fear-combat.org
NS2=n2.fear-combat.org
```

To run a game in portable mode, make the launcher FEARMP.cmd or FEARXP2.cmd<br>
```
start "" FEARMP.exe -UserDirectory Config
start "" FEARXP2.exe -UserDirectory Config +GammaB 1 +GammaG 1 +GammaR 1
```

To run a server in portable mode, make the launcher FEARServer.cmd or FEARServerXP.cmd<br>
```
start "" FEARServer.exe -UserDirectory Config
start "" FEARServerXP.exe -UserDirectory Config
```

To run a game in window mode, make the launcher FEARMPw.cmd or FEARXP2w.cmd<br>
```
start "" FEARMP.exe +Windowed 1 +ScreenWidth 1024 +ScreenHeight 768
start "" FEARXP2.exe +Windowed 1 +ScreenWidth 1024 +ScreenHeight 768
```

To run a game and server in coop mode, make the launcher FEARXP2_CoopMode.cmd or FEARServerXP_CoopMode.cmd<br>
```
start "" FEARXP2.exe -archcfg CoopMode.archcfg +GammaB 1 +GammaG 1 +GammaR 1
start "" FEARServerXP.exe -archcfg CoopMode.archcfg
```

To change the Field of View (FoV), make the launcher FEARMP.cmd or FEARXP2.cmd<br>
```
start "" FEARMP.exe +FovYWidescreen 95.0 +FovY 95.0
start "" FEARXP2.exe +FovYWidescreen 95.0 +FovY 95.0 +GammaB 1 +GammaG 1 +GammaR 1
```

# List of fixes
[Client] DRM-free FEAR.exe as FEARMP.exe for better performance<br>
[Client] Dinput random high drop fps<br>
[Client] SetWindowsHookExA input lag<br>
[Client] Explosion flickering on high refresh rate monitors, like 144hz etc<br>
[Client] Disable load of ICMP.dll, PBCL.dll, PBSV.dll<br>
[Client] Crash on pressing ESC while downloading content<br>
[Client] Crash on pressing TAB when server have more than 16 players<br>
[Client] Run multiple instances<br>
[Client] No pause render when unfocused<br>
[Client] Window style<br>
[Client] Anti-aliasing in windowed mode<br>
[Client] Fonts distortion in windowed mode<br>
[Client] Disable intro on start game<br>
[Client] Grenade throw +5 fake when press W+G+C<br>
[Client] Controls reset if select non eng keyboard and quit<br>
[Client] Connect from favorites to remote servers<br>
[Client] XP2 MOTD link click<br>
[Server] Allowed connections to retail, free, tiny versions<br>
[Server] XP2 AI spawn on coop maps<br>
[Server] Disable load of PBSV.dll<br>
[Server] DoS fake clients spam<br>
[Server] DoS clients chat spam hack<br>
[Server] DoS clients team broadcast spam hack<br>
[Server] Vote hack<br>
[Server] Vote spam hack<br>
[Server] Vote new map crash clients out of index hack<br>
[Server] Vote clear after new map loaded<br>
[Server] Crash early respawn<br>
[Server] Crash animation speed hack<br>
[Server] Crash invalid skey hack<br>
[Server] Crash invalid guid hack<br>
[Server] Crash negative fRate hack<br>
[Server] Crash force load on new map hack<br>
[Server] Crash render stimulus hack<br>
[Server] Crash object alpha hack<br>
[Server] Crash after failed initialization<br>
[Server] Hang when joined 2 players with name 0xFFFF<br>
[Server] Empty config file name on first startup<br>
[Server] Missing creation of AdditionalContent folder<br>
[Server] Run speed hack v1<br>
[Server] Ladder animation glitch<br>
[Server] Multiple kills of same target<br>
[Server] Chat string size limit<br>
[Server] Host options hack<br>
[Server] Pause hack<br>
[Server] Frag self unlimited ammo<br>
[Server] Drop grenade unlimited ammo<br>
[Server] Get weapon hack<br>
[Server] Get health hack<br>
[Server] Get armor hack<br>
[Server] Get gear hack<br>
[Server] Invalid skin hack<br>
[Server] Bulletproof hack v1 and v2<br>
[Server] Immortal player hack<br>
[Server] Damage player hack<br>
[Server] Sounds player hack<br>
[Server] Flashlight player hack<br>
[Server] Pickup distance hack (2m limit)<br>
[Server] Invalid team hack<br>
[Server] SlowMo activate without recharge or recharger hack<br>
[Server] Teleport to players hack<br>
[Server] Teleport to respawn checkpoints hack<br>
[Server] Teleport using SetObjectPos hack<br>
[Server] Player no clip hack<br>
[Server] Player stealth join hack<br>
[Server] Player early respawn glitch<br>
[Server] Weapon fast switch glitch<br>
[Server] Weapon fake fire position hack<br>
[Server] Weapon rapid fire timer in future hack<br>
[Server] Weapon rapid fire invalid msg hack<br>
[Server] Weapon rapid fire unarmed hack<br>
[Server] Weapon fire drop ammo hack<br>
[Server] Weapon switch drop ammo hack<br>
[Server] Weapon reload drop ammo hack<br>
[Server] Weapon melee ammo mod hack<br>
[Server] Pickup objects of enemy or team hack<br>
[Server] Log spam FindObjectsCb<br>
[Server] Log show client ip:port<br>
[Server] Enhanced vote delay<br>
[Server] Enhanced vote ban<br>
[Server] Platform type "L" when running on linux wine<br>

# Tiny Server Builder
This script creates tiny server build where stored only required files to run server, useful for hosts with limited storage. Find the ArchiveEdit v2 in official public SDK, it also needs F.E.A.R. Combat to be installed first.<br>
<details>
  <summary>Original installers SHA256 hashes</summary>

| Name | SHA256 Hash |
|----------------------------------|------------------------------------------------------------------|
| fearcombat_en_107.exe | 28d12729d866fc36d13ab3761c8826edc4eedb3c76d0c823302a4a25cb265bed |
| fearcombat_update_en_107_108.exe | b016866880353a608f5f37184e833e7a25be12227cb671457a1b600b9f1b350b |
| fear_publictools_108.exe | 11aaa4128528403f7bc9ea5119c68051c62b92a99e6411dfd749af55e9b19df8 |

</details>

1. Put batch script https://github.com/Vityacv/fearservmod/blob/master/TinyServerBuilder.cmd to writable folder with enough disk space<br>
2. Add to folder with a script ArchiveEdit.exe, MFC71u.dll, msvcp71.dll, msvcr71.dll<br>
3. Run script and specify game folder (right click to paste path)<br>
4. Wait till script completes and find new server builds in FEARServer or FEARServerXP folders<br>

Also, tiny coop mode server is supported, in the script replaces the filter "Release" "ReleaseXP2" to "ReleaseMultiplayer" "MultiplayerXP2" and two "Default.archcfg" to "CoopMode.archcfg"<br>
To build server with combined coop and multiplayer maps - remove the filter "*.Objects00p" "Release" "ReleaseXP2" and for run multiplayer maps use "Default.archcfg" and for coop use "CoopMode.archcfg" (same file with different name)

# How to launch game or server on Linux using Wine
To launch FEARMP.exe you will need to instruct wine to load winmm.dll from game folder first and then load system winmm.dll using environment variable:
```
WINEDLLOVERRIDES="winmm.dll=n,b" wine FEARMP.exe
```
Same variable is needed to run FEARServer.exe, but you also can disable load of gecko engine and .net
```
WINEDLLOVERRIDES="winmm.dll=n,b;mscoree.dll;mshtml.dll" wine FEARServer.exe
```

# How to compile
Requirements: linux distribution (I use Arch Linux), mingw-w64, nasm

Build steps
```
git clone https://github.com/Vityacv/fearservmod.git
cd fearservmod
git submodule update --init --recursive
mkdir build
cd build
i686-w64-mingw32-cmake -DCMAKE_BUILD_TYPE=Release ..
make
```
For clang builds
```
PATH=/opt/llvm-mingw/llvm-mingw-msvcrt/bin/:$PATH i686-w64-mingw32-cmake -DCMAKE_BUILD_TYPE=Release ..
```
